---
title: 集群概念及应用笔记
date: 2018-10-01 10:52:38
tags: [集群,server]
---

* [集群概念](#集群概念)
* [集群搭建实验集合](#集群搭建实验集合)

<!--more-->

# 集群概念





几种服务器性能增强方式：

* Scale on：向上扩展。也称垂直扩展，在服务器硬件上扩展
* Scale out：向外扩展。也称水平扩展，在服务器数量上扩展



LB集群与HA集群的着眼点：

LB集群是为了增加请求的并发处理能力，而HA集群是为了增加服务的可用性



RAID阵列与NFS的区别：

NFS是文件系统服务器，前端web对数据的请求是文件级别的。属于NAS

NAS具有锁机制，因为NAS是服务器，是有操作系统的，这样就不会造成数据的不一致了。

RAID阵列是磁盘，前端web对数据的请求是块级别的。属于DAS

DAS就是磁盘，无法设置磁盘锁，因为读写操作是在内存中执行的，读取的数据都是在web服务器中执行操作，不同的web服务器读取同一段数据会造成数据的不一致

但是DAS的速度远高于NAS

一个文件包含多个数据块



资源粘性：资源更倾向于运行在哪个节点

节点间通过Messaging Layer传递资源粘性值，但Messaging Layer并不进行比较，而是在CRM（Cluster Resource Manager集群资源管理器）上比较，指定资源应该运行在哪个节点上。



资源约束：Constraint

​	排列约束

​	位置约束（location）



Session共享：

* 基于Cookie的Session共享：

  将全站用户的Session信息加密并序列化后以Cookie的方式统一存放在根域名下，当浏览器访问该根域名下的所有二级域名时，会将域名相对应的所有Cookie内容传递给子服务器，实现用户的Cookie化Session在多个服务器间共享。

  优点：无需额外服务器资源。

  缺点：受HTTP协议头长度限制，仅存储小部分用户信息。

* 基于数据库的Session共享：

  实用性强，但比较复杂，Session的逻辑淘汰也需要自己实现，并且Session的并发读写能力取决于数据库的性能。

* Session复制：

  将用户的Session复制到每个要访问的服务器，Tomcat和Weblogic都带有这种机制，但随机器增加，网络负担会成指数上升。

* 基于Memcached或Redis的Session共享：

  Memcached和Redis适合用于存放Session，Memcached和Redis中的Hash表具有Expires数据淘汰机制，符合Session的要求。并且这两款数据存储系统的性能都很强，能够应对高并发场景。



会话保持：

会话保持不是Session共享。网站中有时一次操作需要与服务器进行多次交互，并且这几次的交互都是紧密联系的，这要求相关操作都要在一台服务器上完成，不能被负载到其他服务器上。

会话保持就是指在负载均衡器上的机制，可识别客户和服务器间交互的关联性，在做负载均衡的同时，还能保持一系列相关的访问都分配到同一台服务器上。



负载均衡器的会话保存机制：

* 基于源IP的持续性保持：主要用于四层负载均衡，如Nginx的ip_hash、HAProxy的source算法。

* 基于Cookie的持续性保持：主要用于七层负载均衡，同一会话的被分配到同一台服务器上。

  根据应答报文中是否带有`Set_Cookie`字段，可分为Cookie插入保持和Cookie截取保持。

* 基于HTTP报文头的持续性保持：主要用于七层负载均衡，负载均衡器首次收到客户端的请求时，会建立该客户端的表项，记录为该客户端分配服务器的情况。在会话表项生存期内，后续具有相同HTTP报文头的连接都发往同一服务器。

