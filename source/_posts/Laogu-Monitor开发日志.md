---
title: Laogu-Monitor开发日志
date: 2018-10-09 19:56:38
tags: [python, 监控, 自动化, 运维]
---

记录我的个人项目Laogu-Monitor监控系统的开发过程。

<!--more-->



# 2018.10.9

开始学习监控系统的开发，基于Django框架。以下是需要考虑的问题：

* 监控的东西

  * 网络层面：网络流量、延迟、存活状态
  * 系统层面：CPU、内存、磁盘分区、负载
  * 应用层面：mysql、tomcat、nginx、django、HAProxy、Squid等
  * 业务层面：PV、UV
  * 硬件层面：磁盘、温度

* 监控的模式

  * 主动监控：监控服务器主动向客户端索取数据

    好处：不需要安装客户端，简单

    坏处：当客户端过多则会出现性能瓶颈，不能灵活定制监控插件

  * 被动监控：客户单主动向监控服务器汇报数据

    好处：对服务器端的压力小，能灵活定制监控插件，延迟小

    坏处：需要安装客户端（若通过自动化软件可轻松实现，也不能算坏处）

* 监控需求：

  * 一台主机监控多个不同服务、不同服务间隔可不同
  * 同一服务在不同主机上监控间隔、报警阈值可不同
  * 可批量给主机添加、删除、修改服务
  * 根据不同的服务以及服务的重要程度设置不同的告警级别并通知特定的用户，并且能实现告警升级
  * 监控数据的存储和优化。实现用最少的空间存储最多的有效数据。在一秒内取出一台主机所有服务的5年记录
  * 监控服务器的水平扩展



采用的C/S架构：**HTTP**

原因：

1. 借口设计简单
2. 容易水平扩展做分布式
3. Socket稳定成熟、省去较多的通信维护精力

监控数据存储：**Redis**



暂时列出以下几项规划：

- 主机监控：
  - 系统状态
  - 网络状态
- 服务监控：
  - web服务
  - LB服务（暂不在计划）
  - HA服务（暂不在计划）
  - HPC服务（暂不在计划）
- 容器监控：
  - docker容器
  - docker镜像
  - docker-swarm服务（暂不在计划）
  - kubernetes服务（暂不在计划）
- 数据库监控：
  - 数据库状态
- 日志管理：
  - 日志收集
  - 日志分析
- 自动化运维：
  - 集成ansible功能（暂不在计划）
  - 告警功能
  - 服务发现
  - 网络拓扑
  - 数据存储
- 用户管理：
  - 权限管理
  - 告警升级（暂不在计划）
  - 访问统计



































