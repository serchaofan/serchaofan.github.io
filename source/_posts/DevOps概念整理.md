---
title: DevOps概念整理
tags: []
categories: []
date: 2020-02-14 18:39:56
---

<!--more-->

# DevOps

# 持续集成、持续交付与持续部署

CI/CD 是一种通过在应用开发阶段引入自动化来频繁向客户交付应用的方法。CI/CD 的核心概念是持续集成、持续交付和持续部署。作为一个面向开发和运营团队的解决方案，CI/CD 主要针对在集成新代码时所引发的问题（亦称：“集成地狱”）。

CI/CD 中的“CI”始终指持续集成，它属于开发人员的自动化流程。成功的 CI 意味着应用代码的新更改会定期构建、测试并合并到共享存储库中。该解决方案可以解决在一次开发中有太多应用分支，从而导致相互冲突的问题。

CI/CD 中的“CD”指的是持续交付和/或持续部署，这些相关概念有时会交叉使用。两者都事关管道后续阶段的自动化，但它们有时也会单独使用，用于说明自动化程度。

{% asset_img 2.png %}

## 持续集成

持续集成（Continuous Integration）：在软件开发过程中，频繁地将代码集成到主干上，然后进行自动化测试。
持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。它的核心措施是，代码集成到主干之前，必须通过自动化测试。只要有一个测试用例失败，就不能集成。

持续集成（CI）可以帮助开发人员更加频繁地（有时甚至每天）将代码更改合并到共享分支或“主干”中。一旦开发人员对应用所做的更改被合并，系统就会通过自动构建应用并运行不同级别的自动化测试（通常是单元测试和集成测试）来验证这些更改，确保这些更改没有对应用造成破坏。这意味着测试内容涵盖了从类和函数到构成整个应用的不同模块。如果自动化测试发现新代码和现有代码之间存在冲突，CI 可以更加轻松地快速修复这些错误。

{% asset_img 1.png %}

优势：

- 快速发现错误。每完成一点更新，就集成到主干，可以快速发现错误，定位错误也比较容易。
- 防止分支大幅偏离主干。如果不是经常集成，主干又在不断更新，会导致以后集成的难度变大，甚至难以集成。

一个 CI 系统的基本功能：

- 软件构建自动化：配置完成后，CI 系统会依照预先制订的时间表，或针对特定事件，对目标软件进行构建
- 构建可持续的自动化检查：能持续获取新增或修改后加入的源代码，CI 系统能不断确认这些新代码是否破坏原有软件的成功构建，这也就减少了开发者检查代码变化情况要花费的时间
- 构建可持续的自动化测试：构建检查的扩展部分，构建后执行预先指定的一套测试规则，完成后触发通知（email，rss 等）
- 生成后后续过程的自动化：当自动化检查和测试完成后，软件构建的周期中可能需要一些额外的任务，如生成文档、打包软件、部署到运行环境等

CI 系统的基本结构：

{% asset_img 3.png %}

CI 系统流程：

1. 开发者将代码提交到源代码仓库
2. CI 为每个项目创建一个单独的工作区，当预设或请求一次新的构建时，CI 会将源代码仓库的源码存放到相应工作区
3. CI 会在对应工作区内执行构建
4. 构建完成后，CI 会在新的构件中执行一套测试（如果配置的话），完成后通过 RSS 或 Email 通知相关人员
5. 若构建成功，该构件会被打包转移到一个部署目标（如应用服务器），或存储为软件仓库中的一个新版本。（软件仓库可以是 CI 系统内部的一个部分（自己搭），也可以是外部的一个仓库（第三方仓库服务））
6. CI 通常会根据请求发起相应的操作，如即时构建、生成报告、或检索一些构建好的构件

## 持续交付

持续交付（Continuous Delivery）：频繁地将软件的新版本，交付给质量团队或者用户，以供评审。如果评审通过，代码就进入生产阶段。持续交付可以看作持续集成的下一步。它强调的是，不管怎么更新，软件是随时随地可以交付的。

完成 CI 中构建及单元测试和集成测试的自动化流程后，持续交付可自动将已验证的代码发布到存储库。为了实现高效的持续交付流程，务必要确保 CI 已内置于开发管道。持续交付的目标是拥有一个可随时部署到生产环境的代码库。
在持续交付中，每个阶段（从代码更改的合并，到生产就绪型构建版本的交付）都涉及测试自动化和代码发布自动化。在流程结束时，运维团队可以快速、轻松地将应用部署到生产环境中。

## 持续部署

持续部署（Continuous Deployment）：代码通过评审以后，自动部署到生产环境，是持续交付的下一步。持续部署的目标是，代码在任何时刻都是可部署的，可以进入生产阶段。持续部署的前提是能自动化完成测试、构建、部署等步骤。

# 自动化

> 参考文章
> [持续集成、持续交付、持续部署简介](https://jaminzhang.github.io/ci/cd/CI-CD-Introduction/)

> [持续集成是什么？](https://www.ruanyifeng.com/blog/2015/09/continuous-integration.html)

> [[持续交付实践] 开篇：持续集成&持续交付综述 ](https://testerhome.com/topics/9977)

> [什么是 CI/CD？](https://www.redhat.com/zh/topics/devops/what-is-ci-cd)

> [Continuous Integration: A “Typical” Process](https://developers.redhat.com/blog/2017/09/06/continuous-integration-a-typical-process/)
